---
title: "Task 6"
output:
  pdf_document: default
  html_document:
    df_print: paged
  word_document: default
  date: "2023-10-04"
geometry: margin=1cm
---

#Basic visualization with R

```{r load the packages, message=FALSE, warning=FALSE, results=FALSE}
#load the package
library(tidyverse)
library(dplyr)
library(gridExtra)
```

## Compare the distribution of the body height of the two species from the 'magic_guys' dataset graphically

**Histogram**

```{r histogram, fig.show='hold', fig.width=6, message=FALSE, warning=FALSE, fig.asp=0.618, out.width="50%", fig.align="center"}
#load the data
magic_guys <- read.csv("/Users/agniavibriani/Downloads/magic_guys.csv")

#categorize based on species

jedi <- dplyr::filter(magic_guys, species == "jedi")
sith <- dplyr::filter(magic_guys, species == "sith")

#build histogram for the distribution of the body height of the two species using basic 'hist' function
#par function uses to show the graph side by side

par(mfrow=c(1,2))
plotJ <-hist(jedi$length, breaks =5,
             main="The body height of jedi",xlab="body height", ylab="frequency",
             border="black", col="lightblue")
plotS <- hist(sith$length, breaks=5, 
              main="The body height of sith", xlab = "body length", ylab="frequency",
              border = "black", col="lightblue")
```

**ggplot**

```{r ggplot, fig.show='hold', fig.width=6, message=FALSE, warning=FALSE, fig.asp=0.618, out.width="50%", fig.align="center"}
#Jedi

#Annotation information which contains the labels that will be displayed

annotation <- data.frame(
x=c(min(jedi$length), max(jedi$length), mean(jedi$length)),
#I determine the y position where the label will be displayed
y=c(0.0025, 0.0015, 0.0095), 
label=c("min", "max", "mean"))

#generate the plot. 

#fist row determines that I'm using "Jedi" datasheet from previous filtering.
#Second row determines geom_histo will be used with Y axis is a density. binwidth size is 20. 
#fill determines the color to be used for filling the bars and color is the color of border
#third row, I add geom_rug to show the location of individual data point
#fourth row,, I add density to show the density curve of the population
#fifth row, I add annotation for min, max, and mean. The annotation has been described before.
#sixth row, defining the title and x axis
#seventh row, adjusting the scale of x axis

ggplotjedi <- ggplot(jedi, aes(length))+
geom_histogram(aes(y=..density..), binwidth = 20, color="black", fill="lightblue")+
geom_rug()+
geom_density(color="red", fill="red", alpha=0.3)+
geom_text(data=annotation, aes(x=x, y=y, label=paste(label,x)), size=3, fontface="bold")+
labs(title = "The body height of jedi", x="body height (cm)")+ 
coord_cartesian(xlim=c(50,300))

#sith
# I use the same way as Jedi graph

annotation <- data.frame(
x=c(min(sith$length), max(sith$length), mean(sith$length)),
y=c(0.008, 0.008, 0.026),
label=c("min", "max", "mean"))

ggplotsith<-ggplot(sith, aes(length))+
geom_histogram(aes(y=..density..), binwidth = 10, color="black", fill="lightblue")+
geom_rug()+
geom_density(color="red", fill="red", alpha=0.3)+
geom_text(data=annotation, aes(x=x, y=y, label=paste(label,x)), size=3, fontface="bold")+
labs(title = "The body height of sith", x="body height (cm)")+
coord_cartesian(xlim = c(60,190))

#show the plot side by side

grobsJ <- ggplotGrob(ggplotjedi)
grobsS <- ggplotGrob(ggplotsith)
grid.arrange(grobsJ, grobsS, ncol=2)
```

**Boxplot**

```{r boxplot, fig.show='hold', fig.width=6, message=FALSE, warning=FALSE, fig.asp=0.618, out.width="50%", fig.align="center"}
ggplot(magic_guys, aes(species, length))+
geom_boxplot()
```

Based on the histogram of heights data of jedi and sith, both species have a normal distribution. The body heights of jedi species has an average 172.22 cm, while the sith species has an average 123.36 cm. Although from the boxplot it looks like both species has skewed distribution, however the number and the position of outliers are not significant to affect the distribution.

**Save the plots with png, pdf, and svg formats. In which situation would you use that format?**

PNG = creating graph for digital publication.

PDF = mostly use for creating document, such as LaTeX.

SVG = if the editing process is needed after saving the image. PNG and PDF are vectorized images, which means they can be rescaled without lowering the quality.

## The gene expression data matrix from the 'microarray_data.tab'

**How big is the matrix in terms of row and columns?**

533 rows and 1000 columns

**Count the missing values per gene and visualize this result**

```{r bar chart, fig.align="center", fig.asp=0.618, fig.show='hold', fig.width=6, message=FALSE, warning=FALSE, out.width="50%"}
load("microarray_data.RData")
#count the missing value in each column and produce the result as a data frame
#the data frame consists of 1000 row as a gene and 1 column as a total count of missing value (I named it as value)
missing_value <- data.frame(Value = colSums(is.na(microarray_data)))

#generate a bar graph
#first row = determine data frame. The x axis will follow the row names, and levels is to ensure the order follow the data frame.
#second row = determine the type of geom. Stat 'identity' uses to specify the　Y value　follow the value column in data frame.
#third row = label the x,y axis and the title.
#forth row = minimal theme is used.
#fifth row = axis.text.x to specify the x-axis label appearance. 'element_text' to rotate the X-axis label text by 45 deg and adjust their horizontal justification to 1.
#sixth row = customize the x-axis scale. It sets the thick marks and label with a sequence every 50 rows.

ggplot(missing_value, aes(x = factor(rownames(missing_value), levels = rownames(missing_value)), y = Value)) +
geom_bar(stat = "identity", fill = "black") +
labs(title = "Total missing value in each gene", x = "Gene", y = "Count") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
scale_x_discrete(breaks = rownames(missing_value)[seq(1, nrow(missing_value), by = 50)], 
labels = rownames(missing_value)[seq(1, nrow(missing_value), by = 50)])
```

**Find the genes for which there are more than X% (X=10,20,50%) missing value**

```{r missing percentage, warning=FALSE}
#calculate missing percentage by using Apply family. 
#Describe the function  --> use apply family to calculate the percentage for each row --> transform to data frame
calculate_percentage <- function(x){(x/553)*100} 
percentage <-apply(missing_value, MARGIN=1, FUN = calculate_percentage)
missing_percentage<-data.frame(percentage)

#Find the genes for which there are more than 10
Missing_10 <-missing_percentage%>%
  filter(missing_percentage>10)%>%
  nrow()
Missing_10
```

Find the genes for which there are more than 20% missing values

```{r}
Missing_20 <-missing_percentage%>%
  filter(missing_percentage>20)%>%
  nrow()
Missing_20
```

Find the genes fpr which there are more than 50% missing values

```{r}
Missing_50 <-missing_percentage%>%
  filter(missing_percentage>50)%>%
  nrow()
Missing_50
```

**Replace the missing values by the average expression value for the particular gene**

```{r}
new_microrray <- microarray_data%>%
mutate_all(~ifelse(is.na(.), mean(., na.rm=TRUE),.))
head(new_microrray)
```

**Visualize the data in the CO2 dataset in a way that gives you a deeper understanding of the data. Explain**

```{r CO2, fig.show='hold', fig.width=6, message=FALSE, warning=FALSE, fig.asp=0.618, out.width="50%", fig.align="center"}
data(CO2)

#generate the graph
ggplot(CO2, aes(y=uptake, x=Treatment, fill=as.factor(conc)))+
geom_bar(stat = "summary", fun="mean", position = "dodge")+
facet_wrap(.~Type)+
labs(x="Treatment", y="mean CO2 uptake", title="Cold resistance of plant")
```

There are several conclusions can be taken from above graph:

1.  Generally, the plant from Quebec has higher CO2 uptake compared with the plant from Mississippi.

2.  Both plants exhibit similar CO2 uptake behavior at different levels of CO2 availability. The CO2 uptake is increasing in line with the higher levels of CO2 availability. However, the Mississippi plant showed a less pronounced increase at the higher levels of CO2 availability (350, 500, 675,1000).

3.  The plant from Quebec shows better cold resistance compared to the plant from Mississippi. Cold temperature significantly reduces CO2 uptake in Mississipi plant.
